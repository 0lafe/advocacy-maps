{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/davidondrich/dev/advocacy-maps/components/Map/Map.jsx\";\nimport { Component } from \"react\";\nimport L from \"leaflet\";\nimport Papa from \"papaparse\";\nimport \"leaflet/dist/leaflet.css\";\nimport \"leaflet-defaulticon-compatibility/dist/leaflet-defaulticon-compatibility.css\";\nimport \"leaflet-defaulticon-compatibility\";\n\nconst districtStyle = rep => ({\n  className: `district district--${rep.commitments ? \"committed\" : \"join\"}`\n});\n\nconst callToAction = rep => `\n  <a class=\"map-link\"\n    href=\"https://actonmass.org/the-campaign/?your_state_representative=${rep.first_name} ${rep.last_name}#join-your-district-team\"\n    target=\"_parent\"\n  >\n    <strong>Join ${rep.commitments ? \"the Campaign\" : \"District Team\"}</strong>\n  </a>\n`;\n\nconst repCommitments = rep => rep.commitments ? `\n\t\t<p>\n      <table>\n        <tr>\n          <th colspan=\"2\">\n            <strong>Committed to vote for:</strong>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"commitment\">${rep.committee_votes ? \"✓\" : \"\"}</td>\n          <td>Committee votes made public</td>\n        </tr>\n        <tr>\n          <td class=\"commitment\">${rep.public_bills ? \"✓\" : \"\"}</td>\n          <td>Bills made public for 72 hours</td>\n        </tr>\n        <tr>\n          <td class=\"commitment\">${rep.roll_call ? \"✓\" : \"\"}</td>\n          <td>Lower threshold for public roll call</td>\n        </tr>\n      </table>\n    </p>\n  ` : \"\";\n\nconst districtPopup = rep => `\n\t<p>\n\t\t<strong>${rep.first_name} ${rep.last_name}</strong>\n\t\t${rep.url ? `(<a href=\"${rep.url}\">contact</a>)` : \"\"}\n\t\t<br />${rep.party ? `${rep.party},` : \"\"}\n\t\t${rep.district}\n\t\t${rep.elect ? \"(Elect)\" : \"\"}\n\t</p>\n\t${repCommitments(rep)}\n\t${callToAction(rep)}\n`;\n\nconst onPopup = e => {\n  const active = e.type === \"popupopen\";\n  e.target.getElement().classList.toggle(\"district--active\", active);\n};\n\nconst districtLegend = () => `\n\t\t<div class=\"legend__item legend__item--committed\">Committed to Vote</div>\n    <div class=\"legend__item legend__item--join\">Join District Team</div>\n`;\n\nconst style = {\n  width: \"100%\",\n  height: \"50vh\"\n};\n\nclass Map extends Component {\n  componentDidMount() {\n    Promise.all([fetch(\"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4l7bRcBIgwsEPGM_s9zF9csIeTgE2No_4tA6MuDCBUbfmWY_e9mAfzPpCJTsIK_hUzOyJ8CmdGMsX/pub?gid=641305740&single=true&output=csv\").then(response => response.text()).then(csv => {\n      const parsed = Papa.parse(csv, {\n        header: true,\n        dynamicTyping: true\n      });\n      return Promise.resolve(parsed.data);\n    }), fetch(\"https://raw.githubusercontent.com/bhrutledge/ma-legislature/main/dist/ma_house.geojson\").then(response => response.json())]).then(([supporters, houseFeatures]) => {\n      const supportersByDistrict = supporters.reduce((acc, cur) => {\n        acc[cur.district] = cur;\n        return acc;\n      }, {});\n      console.log(\"Supports\", supportersByDistrict);\n      console.log(\"HOUSE\", houseFeatures);\n\n      function repProperties(feature) {\n        const supporter = supportersByDistrict[feature.properties.district];\n        return supporter;\n      }\n\n      const houseLayer = L.geoJson(houseFeatures, {\n        style: feature => districtStyle(repProperties(feature)),\n        onEachFeature: (feature, layer) => {\n          const rep = repProperties(feature);\n          layer.bindPopup(districtPopup(rep));\n          layer.on(\"popupopen\", onPopup);\n          layer.on(\"popupclose\", onPopup);\n          feature.properties.index = `${rep.first_name} ${rep.last_name} - ${rep.district}`;\n        }\n      });\n      const searchControl = new L.Control.Search({\n        layer: houseLayer,\n        propertyName: \"index\",\n        initial: false,\n        marker: false,\n        textPlaceholder: \"Search reps and districts\",\n\n        moveToLocation(latlng, title, map) {\n          map.fitBounds(latlng.layer.getBounds());\n          latlng.layer.openPopup();\n        }\n\n      });\n      const legendControl = L.control({\n        position: \"topright\"\n      });\n\n      legendControl.onAdd = () => {\n        const div = L.DomUtil.create(\"div\", \"legend\");\n        div.innerHTML = districtLegend();\n        return div;\n      };\n\n      const baseLayer = L.tileLayer(\"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png\", {\n        attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>'\n      });\n      this.map = L.map(\"map\").addLayer(baseLayer).addLayer(houseLayer).addControl(searchControl).addControl(legendControl).fitBounds(houseLayer.getBounds()); // Avoid accidental excessive zoom out\n\n      this.map.setMinZoom(this.map.getZoom());\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"map\",\n      style: style\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 12\n    }, this);\n  }\n\n}\n\nexport default Map;","map":{"version":3,"sources":["/Users/davidondrich/dev/advocacy-maps/components/Map/Map.jsx"],"names":["Component","L","Papa","districtStyle","rep","className","commitments","callToAction","first_name","last_name","repCommitments","committee_votes","public_bills","roll_call","districtPopup","url","party","district","elect","onPopup","e","active","type","target","getElement","classList","toggle","districtLegend","style","width","height","Map","componentDidMount","Promise","all","fetch","then","response","text","csv","parsed","parse","header","dynamicTyping","resolve","data","json","supporters","houseFeatures","supportersByDistrict","reduce","acc","cur","console","log","repProperties","feature","supporter","properties","houseLayer","geoJson","onEachFeature","layer","bindPopup","on","index","searchControl","Control","Search","propertyName","initial","marker","textPlaceholder","moveToLocation","latlng","title","map","fitBounds","getBounds","openPopup","legendControl","control","position","onAdd","div","DomUtil","create","innerHTML","baseLayer","tileLayer","attribution","addLayer","addControl","setMinZoom","getZoom","render"],"mappings":"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","sourcesContent":["import { Component } from \"react\";\nimport L from \"leaflet\";\nimport Papa from \"papaparse\";\nimport \"leaflet/dist/leaflet.css\";\nimport \"leaflet-defaulticon-compatibility/dist/leaflet-defaulticon-compatibility.css\";\nimport \"leaflet-defaulticon-compatibility\";\n\nconst districtStyle = (rep) => ({\n  className: `district district--${rep.commitments ? \"committed\" : \"join\"}`,\n});\n\nconst callToAction = (rep) => `\n  <a class=\"map-link\"\n    href=\"https://actonmass.org/the-campaign/?your_state_representative=${\n      rep.first_name\n    } ${rep.last_name}#join-your-district-team\"\n    target=\"_parent\"\n  >\n    <strong>Join ${rep.commitments ? \"the Campaign\" : \"District Team\"}</strong>\n  </a>\n`;\n\nconst repCommitments = (rep) =>\n  rep.commitments\n    ? `\n\t\t<p>\n      <table>\n        <tr>\n          <th colspan=\"2\">\n            <strong>Committed to vote for:</strong>\n          </th>\n        </tr>\n        <tr>\n          <td class=\"commitment\">${rep.committee_votes ? \"✓\" : \"\"}</td>\n          <td>Committee votes made public</td>\n        </tr>\n        <tr>\n          <td class=\"commitment\">${rep.public_bills ? \"✓\" : \"\"}</td>\n          <td>Bills made public for 72 hours</td>\n        </tr>\n        <tr>\n          <td class=\"commitment\">${rep.roll_call ? \"✓\" : \"\"}</td>\n          <td>Lower threshold for public roll call</td>\n        </tr>\n      </table>\n    </p>\n  `\n    : \"\";\n\nconst districtPopup = (rep) => `\n\t<p>\n\t\t<strong>${rep.first_name} ${rep.last_name}</strong>\n\t\t${rep.url ? `(<a href=\"${rep.url}\">contact</a>)` : \"\"}\n\t\t<br />${rep.party ? `${rep.party},` : \"\"}\n\t\t${rep.district}\n\t\t${rep.elect ? \"(Elect)\" : \"\"}\n\t</p>\n\t${repCommitments(rep)}\n\t${callToAction(rep)}\n`;\n\nconst onPopup = (e) => {\n  const active = e.type === \"popupopen\";\n  e.target.getElement().classList.toggle(\"district--active\", active);\n};\n\nconst districtLegend = () => `\n\t\t<div class=\"legend__item legend__item--committed\">Committed to Vote</div>\n    <div class=\"legend__item legend__item--join\">Join District Team</div>\n`;\n\nconst style = {\n  width: \"100%\",\n  height: \"50vh\",\n};\n\nclass Map extends Component {\n  componentDidMount() {\n    Promise.all([\n      fetch(\n        \"https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4l7bRcBIgwsEPGM_s9zF9csIeTgE2No_4tA6MuDCBUbfmWY_e9mAfzPpCJTsIK_hUzOyJ8CmdGMsX/pub?gid=641305740&single=true&output=csv\"\n      )\n        .then((response) => response.text())\n        .then((csv) => {\n          const parsed = Papa.parse(csv, { header: true, dynamicTyping: true });\n          return Promise.resolve(parsed.data);\n        }),\n      fetch(\n        \"https://raw.githubusercontent.com/bhrutledge/ma-legislature/main/dist/ma_house.geojson\"\n      ).then((response) => response.json()),\n    ]).then(([supporters, houseFeatures]) => {\n      const supportersByDistrict = supporters.reduce((acc, cur) => {\n        acc[cur.district] = cur;\n        return acc;\n      }, {});\n\n      console.log(\"Supports\", supportersByDistrict);\n      console.log(\"HOUSE\", houseFeatures);\n\n      function repProperties(feature) {\n        const supporter = supportersByDistrict[feature.properties.district];\n        return supporter;\n      }\n\n      const houseLayer = L.geoJson(houseFeatures, {\n        style: (feature) => districtStyle(repProperties(feature)),\n        onEachFeature: (feature, layer) => {\n          const rep = repProperties(feature);\n          layer.bindPopup(districtPopup(rep));\n          layer.on(\"popupopen\", onPopup);\n          layer.on(\"popupclose\", onPopup);\n          feature.properties.index = `${rep.first_name} ${rep.last_name} - ${rep.district}`;\n        },\n      });\n\n      const searchControl = new L.Control.Search({\n        layer: houseLayer,\n        propertyName: \"index\",\n        initial: false,\n        marker: false,\n        textPlaceholder: \"Search reps and districts\",\n        moveToLocation(latlng, title, map) {\n          map.fitBounds(latlng.layer.getBounds());\n          latlng.layer.openPopup();\n        },\n      });\n\n      const legendControl = L.control({ position: \"topright\" });\n      legendControl.onAdd = () => {\n        const div = L.DomUtil.create(\"div\", \"legend\");\n        div.innerHTML = districtLegend();\n        return div;\n      };\n      const baseLayer = L.tileLayer(\n        \"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png\",\n        {\n          attribution:\n            '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n        }\n      );\n\n      this.map = L.map(\"map\")\n        .addLayer(baseLayer)\n        .addLayer(houseLayer)\n        .addControl(searchControl)\n        .addControl(legendControl)\n        .fitBounds(houseLayer.getBounds());\n\n      // Avoid accidental excessive zoom out\n      this.map.setMinZoom(this.map.getZoom());\n    });\n  }\n\n  render() {\n    return <div id=\"map\" style={style}></div>;\n  }\n}\n\nexport default Map;\n"]},"metadata":{},"sourceType":"module"}